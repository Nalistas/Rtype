\chapter{Web\+Socket Client \& Server Implementation for Node}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README}{}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README}\index{WebSocket Client \& Server Implementation for Node@{WebSocket Client \& Server Implementation for Node}}
\href{http://badge.fury.io/js/websocket}{\texttt{ }}

\href{https://www.npmjs.com/package/websocket}{\texttt{ }}

\href{https://codeship.com/projects/61106}{\texttt{ }}\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7353}{}\doxysection{\texorpdfstring{Overview}{Overview}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7353}
This is a (mostly) pure Java\+Script implementation of the Web\+Socket protocol versions 8 and 13 for Node. There are some example client and server applications that implement various interoperability testing protocols in the "{}test/scripts"{} folder.\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7354}{}\doxysection{\texorpdfstring{Documentation}{Documentation}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7354}
You can read the full API documentation in the docs folder.\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7355}{}\doxysubsection{\texorpdfstring{Changelog}{Changelog}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7355}
{\itshape {\bfseries{Current Version\+: 1.\+0.\+35}}} -\/ Release 2024-\/05-\/12


\begin{DoxyItemize}
\item \href{https://github.com/theturtle32/WebSocket-Node/pull/455}{\texttt{ Updated}} from \href{https://security.snyk.io/vuln/SNYK-JS-ES5EXT-6095076}{\texttt{ vulnerable version}} of es5-\/ext to a newer version that has been patched. Thanks, \href{https://github.com/Tringapps-Dharshan}{\texttt{ @\+Tringapps-\/Dharshan}}
\end{DoxyItemize}

\doxysectlink{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2CHANGELOG}{View the full changelog}{0}\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7356}{}\doxysubsection{\texorpdfstring{Browser Support}{Browser Support}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7356}
All current browsers are fully\texorpdfstring{$\ast$}{*} supported.


\begin{DoxyItemize}
\item Firefox 7-\/9 (Old) (Protocol Version 8)
\item Firefox 10+ (Protocol Version 13)
\item Chrome 14,15 (Old) (Protocol Version 8)
\item Chrome 16+ (Protocol Version 13)
\item Internet Explorer 10+ (Protocol Version 13)
\item Safari 6+ (Protocol Version 13)
\end{DoxyItemize}

(Not all W3C Web\+Socket features are supported by browsers. More info in the Full API documentation)\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7357}{}\doxysubsection{\texorpdfstring{Benchmarks}{Benchmarks}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7357}
There are some basic benchmarking sections in the Autobahn test suite. I\textquotesingle{}ve put up a \href{http://theturtle32.github.com/WebSocket-Node/benchmarks/}{\texttt{ benchmark page}} that shows the results from the Autobahn tests run against Autobahn\+Server 0.\+4.\+10, Web\+Socket-\/\+Node 1.\+0.\+2, Web\+Socket-\/\+Node 1.\+0.\+4, and ws 0.\+3.\+4.

(These benchmarks are quite a bit outdated at this point, so take them with a grain of salt. Anyone up for running new benchmarks? I\textquotesingle{}ll link to your report.)\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7358}{}\doxysubsection{\texorpdfstring{Autobahn Tests}{Autobahn Tests}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7358}
The very complete \href{http://autobahn.ws/testsuite/}{\texttt{ Autobahn Test Suite}} is used by most Web\+Socket implementations to test spec compliance and interoperability.


\begin{DoxyItemize}
\item \href{http://theturtle32.github.com/WebSocket-Node/test-report/servers/}{\texttt{ View Server Test Results}}
\end{DoxyItemize}\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7359}{}\doxysubsection{\texorpdfstring{Installation}{Installation}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7359}
In your project root\+: \begin{DoxyVerb}$ npm install websocket
\end{DoxyVerb}
 Then in your code\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ WebSocketServer\ =\ require('websocket').server;}
\DoxyCodeLine{var\ WebSocketClient\ =\ require('websocket').client;}
\DoxyCodeLine{var\ WebSocketFrame\ \ =\ require('websocket').frame;}
\DoxyCodeLine{var\ WebSocketRouter\ =\ require('websocket').router;}
\DoxyCodeLine{var\ W3CWebSocket\ =\ require('websocket').w3cwebsocket;}

\end{DoxyCode}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7360}{}\doxysubsection{\texorpdfstring{Current Features\+:}{Current Features\+:}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7360}

\begin{DoxyItemize}
\item Licensed under the Apache License, Version 2.\+0
\item Protocol version "{}8"{} and "{}13"{} (Draft-\/08 through the final RFC) framing and handshake
\item Can handle/aggregate received fragmented messages
\item Can fragment outgoing messages
\item Router to mount multiple applications to various path and protocol combinations
\item TLS supported for outbound connections via Web\+Socket\+Client
\item TLS supported for server connections (use https.\+create\+Server instead of http.\+create\+Server)
\begin{DoxyItemize}
\item Thanks to \href{https://github.com/pors}{\texttt{ pors}} for confirming this!
\end{DoxyItemize}
\item Cookie setting and parsing
\item Tunable settings
\begin{DoxyItemize}
\item Max Receivable Frame Size
\item Max Aggregate Received\+Message Size
\item Whether to fragment outgoing messages
\item Fragmentation chunk size for outgoing messages
\item Whether to automatically send ping frames for the purposes of keepalive
\item Keep-\/alive ping interval
\item Whether or not to automatically assemble received fragments (allows application to handle individual fragments directly)
\item How long to wait after sending a close frame for acknowledgment before closing the socket.
\end{DoxyItemize}
\item \href{http://www.w3.org/TR/websockets/}{\texttt{ W3C Web\+Socket API}} for applications running on both Node and browsers (via the {\ttfamily W3\+CWeb\+Socket} class).
\end{DoxyItemize}\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7361}{}\doxysubsection{\texorpdfstring{Known Issues/\+Missing Features\+:}{Known Issues/\+Missing Features\+:}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7361}

\begin{DoxyItemize}
\item No API for user-\/provided protocol extensions.
\end{DoxyItemize}\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7362}{}\doxysection{\texorpdfstring{Usage Examples}{Usage Examples}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7362}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7363}{}\doxysubsection{\texorpdfstring{Server Example}{Server Example}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7363}
Here\textquotesingle{}s a short example showing a server that echos back anything sent to it, whether utf-\/8 or binary.


\begin{DoxyCode}{0}
\DoxyCodeLine{\#!/usr/bin/env\ node}
\DoxyCodeLine{var\ WebSocketServer\ =\ require('websocket').server;}
\DoxyCodeLine{var\ http\ =\ require('http');}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ http.createServer(function(request,\ response)\ \{}
\DoxyCodeLine{\ \ \ \ console.log((new\ Date())\ +\ '\ Received\ request\ for\ '\ +\ request.url);}
\DoxyCodeLine{\ \ \ \ response.writeHead(404);}
\DoxyCodeLine{\ \ \ \ response.end();}
\DoxyCodeLine{\});}
\DoxyCodeLine{server.listen(8080,\ function()\ \{}
\DoxyCodeLine{\ \ \ \ console.log((new\ Date())\ +\ '\ Server\ is\ listening\ on\ port\ 8080');}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{wsServer\ =\ new\ WebSocketServer(\{}
\DoxyCodeLine{\ \ \ \ httpServer:\ server,}
\DoxyCodeLine{\ \ \ \ //\ You\ should\ not\ use\ autoAcceptConnections\ for\ production}
\DoxyCodeLine{\ \ \ \ //\ applications,\ as\ it\ defeats\ all\ standard\ cross-\/origin\ protection}
\DoxyCodeLine{\ \ \ \ //\ facilities\ built\ into\ the\ protocol\ and\ the\ browser.\ \ You\ should}
\DoxyCodeLine{\ \ \ \ //\ *always*\ verify\ the\ connection's\ origin\ and\ decide\ whether\ or\ not}
\DoxyCodeLine{\ \ \ \ //\ to\ accept\ it.}
\DoxyCodeLine{\ \ \ \ autoAcceptConnections:\ false}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{function\ originIsAllowed(origin)\ \{}
\DoxyCodeLine{\ \ //\ put\ logic\ here\ to\ detect\ whether\ the\ specified\ origin\ is\ allowed.}
\DoxyCodeLine{\ \ return\ true;}
\DoxyCodeLine{\}}
\DoxyCodeLine{}
\DoxyCodeLine{wsServer.on('request',\ function(request)\ \{}
\DoxyCodeLine{\ \ \ \ if\ (!originIsAllowed(request.origin))\ \{}
\DoxyCodeLine{\ \ \ \ \ \ //\ Make\ sure\ we\ only\ accept\ requests\ from\ an\ allowed\ origin}
\DoxyCodeLine{\ \ \ \ \ \ request.reject();}
\DoxyCodeLine{\ \ \ \ \ \ console.log((new\ Date())\ +\ '\ Connection\ from\ origin\ '\ +\ request.origin\ +\ '\ rejected.');}
\DoxyCodeLine{\ \ \ \ \ \ return;}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ var\ connection\ =\ request.accept('echo-\/protocol',\ request.origin);}
\DoxyCodeLine{\ \ \ \ console.log((new\ Date())\ +\ '\ Connection\ accepted.');}
\DoxyCodeLine{\ \ \ \ connection.on('message',\ function(message)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (message.type\ ===\ 'utf8')\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ console.log('Received\ Message:\ '\ +\ message.utf8Data);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ connection.sendUTF(message.utf8Data);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ else\ if\ (message.type\ ===\ 'binary')\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ console.log('Received\ Binary\ Message\ of\ '\ +\ message.binaryData.length\ +\ '\ bytes');}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ connection.sendBytes(message.binaryData);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ connection.on('close',\ function(reasonCode,\ description)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ console.log((new\ Date())\ +\ '\ Peer\ '\ +\ connection.remoteAddress\ +\ '\ disconnected.');}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\});}

\end{DoxyCode}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7364}{}\doxysubsection{\texorpdfstring{Client Example}{Client Example}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7364}
This is a simple example client that will print out any utf-\/8 messages it receives on the console, and periodically sends a random number.

{\itshape This code demonstrates a client in Node.\+js, not in the browser}


\begin{DoxyCode}{0}
\DoxyCodeLine{\#!/usr/bin/env\ node}
\DoxyCodeLine{var\ WebSocketClient\ =\ require('websocket').client;}
\DoxyCodeLine{}
\DoxyCodeLine{var\ client\ =\ new\ WebSocketClient();}
\DoxyCodeLine{}
\DoxyCodeLine{client.on('connectFailed',\ function(error)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('Connect\ Error:\ '\ +\ error.toString());}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{client.on('connect',\ function(connection)\ \{}
\DoxyCodeLine{\ \ \ \ console.log('WebSocket\ Client\ Connected');}
\DoxyCodeLine{\ \ \ \ connection.on('error',\ function(error)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ console.log("{}Connection\ Error:\ "{}\ +\ error.toString());}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ connection.on('close',\ function()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ console.log('echo-\/protocol\ Connection\ Closed');}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ connection.on('message',\ function(message)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (message.type\ ===\ 'utf8')\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ console.log("{}Received:\ '"{}\ +\ message.utf8Data\ +\ "{}'"{});}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \});}
\DoxyCodeLine{\ \ \ \ }
\DoxyCodeLine{\ \ \ \ function\ sendNumber()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (connection.connected)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ var\ number\ =\ Math.round(Math.random()\ *\ 0xFFFFFF);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ connection.sendUTF(number.toString());}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ setTimeout(sendNumber,\ 1000);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ sendNumber();}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{client.connect('ws://localhost:8080/',\ 'echo-\/protocol');}

\end{DoxyCode}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7365}{}\doxysubsection{\texorpdfstring{Client Example using the {\itshape W3C Web\+Socket API}}{Client Example using the {\itshape W3C Web\+Socket API}}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7365}
Same example as above but using the \href{http://www.w3.org/TR/websockets/}{\texttt{ W3C Web\+Socket API}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ W3CWebSocket\ =\ require('websocket').w3cwebsocket;}
\DoxyCodeLine{}
\DoxyCodeLine{var\ client\ =\ new\ W3CWebSocket('ws://localhost:8080/',\ 'echo-\/protocol');}
\DoxyCodeLine{}
\DoxyCodeLine{client.onerror\ =\ function()\ \{}
\DoxyCodeLine{\ \ \ \ console.log('Connection\ Error');}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{client.onopen\ =\ function()\ \{}
\DoxyCodeLine{\ \ \ \ console.log('WebSocket\ Client\ Connected');}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ \ \ function\ sendNumber()\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ if\ (client.readyState\ ===\ client.OPEN)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ var\ number\ =\ Math.round(Math.random()\ *\ 0xFFFFFF);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ client.send(number.toString());}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ setTimeout(sendNumber,\ 1000);}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\ \ \ \ sendNumber();}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{client.onclose\ =\ function()\ \{}
\DoxyCodeLine{\ \ \ \ console.log('echo-\/protocol\ Client\ Closed');}
\DoxyCodeLine{\};}
\DoxyCodeLine{}
\DoxyCodeLine{client.onmessage\ =\ function(e)\ \{}
\DoxyCodeLine{\ \ \ \ if\ (typeof\ e.data\ ===\ 'string')\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ console.log("{}Received:\ '"{}\ +\ e.data\ +\ "{}'"{});}
\DoxyCodeLine{\ \ \ \ \}}
\DoxyCodeLine{\};}

\end{DoxyCode}
\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7366}{}\doxysubsection{\texorpdfstring{Request Router Example}{Request Router Example}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7366}
For an example of using the request router, see {\ttfamily libwebsockets-\/test-\/server.\+js} in the {\ttfamily test} folder.\hypertarget{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7367}{}\doxysubsection{\texorpdfstring{Resources}{Resources}}\label{md__2home_2solype_2delivery_2current__days_2Mannheim_2front_2node__modules_2websocket_2README_autotoc_md7367}
A presentation on the state of the Web\+Sockets protocol that I gave on July 23, 2011 at the LA Hacker News meetup. \href{http://www.scribd.com/doc/60898569/WebSockets-The-Real-Time-Web-Delivered}{\texttt{ Web\+Sockets\+: The Real-\/\+Time Web, Delivered}} 